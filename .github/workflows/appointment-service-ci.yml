name: Appointment Service CI Test

on:
  push:
    paths:
      - 'appointment_scheduling_service/**'

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Mock AWS Credentials
        run: |
          echo "Setting up mock AWS environment"
          echo "AWS_ACCESS_KEY_ID=mock-appointment-key" >> $GITHUB_ENV
          echo "AWS_SECRET_ACCESS_KEY=mock-appointment-secret" >> $GITHUB_ENV
          echo "AWS_REGION=ap-south-1" >> $GITHUB_ENV

      - name: Mock ECR Login
        id: login-ecr
        run: |
          echo "::set-output name=registry::mock-appointment-registry.dkr.ecr.ap-south-1.amazonaws.com"

      - name: Simulate Build and Push
        env:
          ECR_REGISTRY: ${{ steps.login-ecr.outputs.registry }}
        run: |
          echo "Simulating appointment service build process..."
          echo "Building image: $ECR_REGISTRY/healthsync-appointment-service:$GITHUB_SHA"
          echo "Would execute: docker build -t $ECR_REGISTRY/healthsync-appointment-service:$GITHUB_SHA ./appointment_scheduling_service"
          echo "Would push to: $ECR_REGISTRY/healthsync-appointment-service:$GITHUB_SHA"
          echo "Would tag as: $ECR_REGISTRY/healthsync-appointment-service:latest"
          echo "Would push latest tag"

      - name: Verify Simulation Steps
        run: |
          echo "âœ… Simulation completed successfully"
          echo "Image would be available at: $ECR_REGISTRY/healthsync-appointment-service:$GITHUB_SHA"
          echo "Latest tag would be: $ECR_REGISTRY/healthsync-appointment-service:latest"
          echo "All appointment service simulation steps passed"
